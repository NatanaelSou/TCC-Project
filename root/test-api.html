<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da API - Plataforma de Conte√∫do</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .test-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-running { background: #cce5ff; color: #004085; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .run-all-button {
            background: #28a745;
            margin-bottom: 20px;
        }

        .run-all-button:hover {
            background: #218838;
        }

        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-info {
            background: #cce5ff;
            border: 1px solid #b3d7ff;
            color: #004085;
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
        }

        .summary h2 {
            margin-top: 0;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s ease;
        }

        .test-input {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
        }

        .test-input:focus {
            outline: none;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste da API - Plataforma de Conte√∫do</h1>

        <button id="runAllTests" class="test-button run-all-button">Executar Todos os Testes</button>

        <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>

        <div id="testResults"></div>

        <div id="summary" class="summary" style="display: none;">
            <h2>üìä Resultado Final</h2>
            <p id="summaryText"></p>
        </div>
    </div>

    <script>
        // Configura√ß√µes da API
        const API_BASE_URL = 'http://localhost:3001/api';

        // Estado dos testes
        let testResults = [];
        let currentTestIndex = 0;
        let testUser = null;
        let testToken = null;
        let testCreator = null;
        let testContent = null;

        // Elementos DOM
        const testResultsDiv = document.getElementById('testResults');
        const runAllButton = document.getElementById('runAllTests');
        const progressFill = document.getElementById('progressFill');
        const summaryDiv = document.getElementById('summary');
        const summaryText = document.getElementById('summaryText');

        // Fun√ß√£o para fazer requisi√ß√µes HTTP
        async function makeRequest(method, url, data = null, token = null) {
            try {
                const config = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (token) {
                    config.headers['Authorization'] = `Bearer ${token}`;
                }

                if (data) {
                    config.body = JSON.stringify(data);
                }

                const response = await fetch(`${API_BASE_URL}${url}`, config);
                const responseData = await response.json();

                return {
                    success: response.ok,
                    data: responseData,
                    status: response.status
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    status: 0
                };
            }
        }

        // Fun√ß√£o para atualizar status do teste
        function updateTestStatus(testId, status, result = '') {
            const testDiv = document.getElementById(`test-${testId}`);
            if (!testDiv) return;

            const statusElement = testDiv.querySelector('.test-status');
            const resultElement = testDiv.querySelector('.test-result');

            statusElement.className = `test-status status-${status}`;
            statusElement.textContent = status.toUpperCase();

            if (result) {
                resultElement.className = `test-result result-${status}`;
                resultElement.textContent = result;
            }
        }

        // Fun√ß√£o para criar elemento de teste
        function createTestElement(testId, title, description) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            testDiv.id = `test-${testId}`;

            testDiv.innerHTML = `
                <div class="test-header">
                    <div class="test-title">${title}</div>
                    <div class="test-status status-pending">PENDENTE</div>
                </div>
                <p>${description}</p>
                <button class="test-button" onclick="runTest('${testId}')">Executar Teste</button>
                <div class="test-result result-info"></div>
            `;

            return testDiv;
        }

        // Teste 1: Verificar sa√∫de da API
        async function testAPIHealth() {
            updateTestStatus('health', 'running');

            const result = await makeRequest('GET', '/health');

            if (result.success) {
                updateTestStatus('health', 'success',
                    `‚úÖ API est√° saud√°vel!\nüìä Status: ${JSON.stringify(result.data, null, 2)}`);
                return true;
            } else {
                updateTestStatus('health', 'error',
                    `‚ùå Erro na API: ${result.error}\nüìä Status: ${result.status}`);
                return false;
            }
        }

        // Teste 2: Registrar novo usu√°rio
        async function testUserRegistration() {
            updateTestStatus('register', 'running');

            const userData = {
                username: 'testuser_' + Date.now(),
                email: 'test' + Date.now() + '@example.com',
                password: 'testpassword123',
                full_name: 'Usu√°rio de Teste'
            };

            const result = await makeRequest('POST', '/users/register', userData);

            if (result.success) {
                testUser = result.data.user;
                updateTestStatus('register', 'success',
                    `‚úÖ Usu√°rio registrado!\nüë§ Username: ${testUser.username}\nüìß Email: ${testUser.email}`);
                return true;
            } else {
                updateTestStatus('register', 'error',
                    `‚ùå Erro no registro: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 3: Fazer login
        async function testUserLogin() {
            updateTestStatus('login', 'running');

            if (!testUser) {
                updateTestStatus('login', 'error', '‚ùå Nenhum usu√°rio de teste dispon√≠vel');
                return false;
            }

            const loginData = {
                email: testUser.email,
                password: 'testpassword123'
            };

            const result = await makeRequest('POST', '/users/login', loginData);

            if (result.success) {
                testToken = result.data.token;
                updateTestStatus('login', 'success',
                    `‚úÖ Login realizado!\nüîë Token JWT obtido\nüë§ Usu√°rio: ${result.data.user.username}`);
                return true;
            } else {
                updateTestStatus('login', 'error',
                    `‚ùå Erro no login: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 4: Obter perfil do usu√°rio
        async function testGetUserProfile() {
            updateTestStatus('profile', 'running');

            if (!testToken) {
                updateTestStatus('profile', 'error', '‚ùå Nenhum token dispon√≠vel');
                return false;
            }

            const result = await makeRequest('GET', '/users/profile', null, testToken);

            if (result.success) {
                updateTestStatus('profile', 'success',
                    `‚úÖ Perfil obtido!\nüë§ Username: ${result.data.user.username}\nüìß Email: ${result.data.user.email}`);
                return true;
            } else {
                updateTestStatus('profile', 'error',
                    `‚ùå Erro ao obter perfil: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 5: Criar canal de criador
        async function testCreateCreatorChannel() {
            updateTestStatus('creator', 'running');

            if (!testToken) {
                updateTestStatus('creator', 'error', '‚ùå Nenhum token dispon√≠vel');
                return false;
            }

            const channelData = {
                channel_name: 'Canal de Teste ' + Date.now(),
                channel_description: 'Este √© um canal de teste para valida√ß√£o da API'
            };

            const result = await makeRequest('POST', '/creators/channel', channelData, testToken);

            if (result.success) {
                testCreator = result.data.creator;
                updateTestStatus('creator', 'success',
                    `‚úÖ Canal criado!\nüé¨ Nome: ${testCreator.channel_name}\nüìù Descri√ß√£o: ${testCreator.channel_description}`);
                return true;
            } else {
                updateTestStatus('creator', 'error',
                    `‚ùå Erro ao criar canal: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 6: Criar conte√∫do
        async function testCreateContent() {
            updateTestStatus('content', 'running');

            if (!testToken || !testCreator) {
                updateTestStatus('content', 'error', '‚ùå Token ou criador n√£o dispon√≠vel');
                return false;
            }

            const contentData = {
                title: 'V√≠deo de Teste ' + Date.now(),
                description: 'Este √© um v√≠deo de teste para valida√ß√£o da API',
                video_url: 'https://example.com/video.mp4',
                thumbnail_url: 'https://example.com/thumbnail.jpg',
                category_id: '550e8400-e29b-41d4-a716-446655440000',
                tags: ['teste', 'api', 'backend']
            };

            const result = await makeRequest('POST', '/content', contentData, testToken);

            if (result.success) {
                testContent = result.data.content;
                updateTestStatus('content', 'success',
                    `‚úÖ Conte√∫do criado!\nüé• T√≠tulo: ${testContent.title}\nüìù Descri√ß√£o: ${testContent.description}`);
                return true;
            } else {
                updateTestStatus('content', 'error',
                    `‚ùå Erro ao criar conte√∫do: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 7: Listar conte√∫do
        async function testListContent() {
            updateTestStatus('list', 'running');

            const result = await makeRequest('GET', '/content');

            if (result.success) {
                const contentCount = result.data.content ? result.data.content.length : 0;
                updateTestStatus('list', 'success',
                    `‚úÖ Conte√∫do listado!\nüìä Total de itens: ${contentCount}`);
                return true;
            } else {
                updateTestStatus('list', 'error',
                    `‚ùå Erro ao listar conte√∫do: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Teste 8: Obter criadores populares
        async function testGetPopularCreators() {
            updateTestStatus('popular', 'running');

            const result = await makeRequest('GET', '/creators/popular');

            if (result.success) {
                const creatorsCount = result.data.creators ? result.data.creators.length : 0;
                updateTestStatus('popular', 'success',
                    `‚úÖ Criadores populares obtidos!\nüìä Total de criadores: ${creatorsCount}`);
                return true;
            } else {
                updateTestStatus('popular', 'error',
                    `‚ùå Erro ao obter criadores populares: ${JSON.stringify(result.error, null, 2)}`);
                return false;
            }
        }

        // Fun√ß√£o para executar teste espec√≠fico
        async function runTest(testId) {
            switch (testId) {
                case 'health':
                    return await testAPIHealth();
                case 'register':
                    return await testUserRegistration();
                case 'login':
                    return await testUserLogin();
                case 'profile':
                    return await testGetUserProfile();
                case 'creator':
                    return await testCreateCreatorChannel();
                case 'content':
                    return await testCreateContent();
                case 'list':
                    return await testListContent();
                case 'popular':
                    return await testGetPopularCreators();
                default:
                    return false;
            }
        }

        // Fun√ß√£o para executar todos os testes
        async function runAllTests() {
            runAllButton.disabled = true;
            runAllButton.textContent = 'Executando Testes...';

            testResults = [];
            currentTestIndex = 0;

            const tests = [
                { id: 'health', name: 'Sa√∫de da API' },
                { id: 'register', name: 'Registro de Usu√°rio' },
                { id: 'login', name: 'Login de Usu√°rio' },
                { id: 'profile', name: 'Perfil do Usu√°rio' },
                { id: 'creator', name: 'Criar Canal' },
                { id: 'content', name: 'Criar Conte√∫do' },
                { id: 'list', name: 'Listar Conte√∫do' },
                { id: 'popular', name: 'Criadores Populares' }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                const success = await runTest(test.id);
                testResults.push({ name: test.name, success });

                // Atualizar barra de progresso
                const progress = ((i + 1) / tests.length) * 100;
                progressFill.style.width = `${progress}%`;

                // Pequena pausa entre testes
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Mostrar resultado final
            showSummary();

            runAllButton.disabled = false;
            runAllButton.textContent = 'Executar Todos os Testes';
        }

        // Fun√ß√£o para mostrar resumo
        function showSummary() {
            const total = testResults.length;
            const passed = testResults.filter(t => t.success).length;
            const failed = total - passed;
            const successRate = ((passed / total) * 100).toFixed(1);

            summaryText.innerHTML = `
                <strong>Total de testes:</strong> ${total}<br>
                <strong>‚úÖ Aprovados:</strong> ${passed}<br>
                <strong>‚ùå Reprovados:</strong> ${failed}<br>
                <strong>üìà Taxa de sucesso:</strong> ${successRate}%
            `;

            summaryDiv.style.display = 'block';

            if (failed === 0) {
                summaryText.innerHTML += '<br><br>üéâ Todos os testes passaram! A API est√° funcionando corretamente.';
            } else {
                summaryText.innerHTML += `<br><br>‚ö†Ô∏è ${failed} teste(s) falharam. Verifique os logs acima para detalhes.`;
            }
        }

        // Inicializar p√°gina
        function initializePage() {
            const tests = [
                {
                    id: 'health',
                    title: 'ü©∫ Teste de Sa√∫de da API',
                    description: 'Verifica se a API est√° respondendo corretamente'
                },
                {
                    id: 'register',
                    title: 'üë§ Registro de Usu√°rio',
                    description: 'Testa o registro de um novo usu√°rio na plataforma'
                },
                {
                    id: 'login',
                    title: 'üîê Login de Usu√°rio',
                    description: 'Testa o processo de autentica√ß√£o do usu√°rio'
                },
                {
                    id: 'profile',
                    title: 'üë§ Perfil do Usu√°rio',
                    description: 'Testa a obten√ß√£o do perfil do usu√°rio logado'
                },
                {
                    id: 'creator',
                    title: 'üé¨ Criar Canal de Criador',
                    description: 'Testa a cria√ß√£o de um canal para criadores de conte√∫do'
                },
                {
                    id: 'content',
                    title: 'üé• Criar Conte√∫do',
                    description: 'Testa a cria√ß√£o de novo conte√∫do/v√≠deo'
                },
                {
                    id: 'list',
                    title: 'üìã Listar Conte√∫do',
                    description: 'Testa a listagem de conte√∫do dispon√≠vel'
                },
                {
                    id: 'popular',
                    title: '‚≠ê Criadores Populares',
                    description: 'Testa a obten√ß√£o de criadores mais populares'
                }
            ];

            tests.forEach(test => {
                const testElement = createTestElement(test.id, test.title, test.description);
                testResultsDiv.appendChild(testElement);
            });

            runAllButton.addEventListener('click', runAllTests);
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
